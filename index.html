<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrailBites - Trail Locations Map</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Trail Snaaaaaaaacks</h1>
        <p>Places we go to snack along the trail</p>
    </header>
    
    <main>
        <div id="controls">
            <button id="loadData" onclick="loadTrailData()">Reload Trail Data</button>
            <button id="toggleRoutes" onclick="toggleRoutes()" style="display: none;">Hide Routes</button>
            <div id="info">Loading trail data...</div>
            <div id="legend" style="display: none;">
                <strong>Difficulty Legend:</strong>
                <ul class="legend-items">
                    <li class="legend-item"><span class="legend-dot green"></span>Direct trail access, no part of route is on road</li>
                    <li class="legend-item"><span class="legend-dot ltblue"></span>Less than two blocks on calm or minor roads</li>
                    <li class="legend-item"><span class="legend-dot yellow"></span>Short sections on side roads</li>
                    <li class="legend-item"><span class="legend-dot orange"></span>Short sections on busier roads</li>
                    <li class="legend-item"><span class="legend-dot blue"></span>Section on major roads</li>
                </ul>
            </div>
        </div>
        
        <div id="map">
            <div style="display: flex; justify-content: center; align-items: center; height: 100%; background: #f5f5f5; color: #666;">
                <div style="text-align: center;">
                    <div style="margin-bottom: 15px;">üó∫Ô∏è</div>
                    <div>Initializing map...</div>
                </div>
            </div>
        </div>
        
        <div id="trails-table-container" style="display: none;">
            <h2>Trail Locations</h2>
            <div id="table-controls">
                <input type="text" id="search-input" placeholder="Search trails..." />
                <select id="difficulty-filter">
                    <option value="">All Difficulties</option>
                    <option value="1">1 - Very Easy</option>
                    <option value="2">2 - Easy</option>
                    <option value="3">3 - Moderate</option>
                    <option value="4">4 - Difficult</option>
                    <option value="5">5 - Very Difficult</option>
                </select>
            </div>
            <div id="trails-table-wrapper">
                <table id="trails-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Difficulty</th>
                            <th>Trail</th>
                            <th>Description</th>
                            <th>Comments</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trails-table-body">
                        <!-- Trails will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="csvParser.js"></script>
    <script src="mapHandler.js"></script>
    <script>
        // Load Google Maps API with smart key detection
        async function loadGoogleMapsAPI() {
            let apiKey = 'MAPS_API_KEY'; // Default fallback for GitHub Actions
            
            // Try to load from local-config.json first
            try {
                const response = await fetch('local-config.json');
                if (response.ok) {
                    const config = await response.json();
                    if (config.maps) {
                        apiKey = config.maps;
                        console.log('Using API key from local-config.json');
                    }
                }
            } catch (error) {
                console.log('No local-config.json found, using default key');
            }
            
            // Create and load the Google Maps script
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=marker&callback=initMap`;
            script.async = true;
            script.defer = true;
            
            script.onerror = () => {
                console.error('Failed to load Google Maps API');
                document.getElementById('map').innerHTML = `
                    <div style="padding: 40px; text-align: center; background: #ffebee; color: #c62828; border-radius: 8px;">
                        <h3>Google Maps API Error</h3>
                        <p>Please check your API key configuration.</p>
                        <p><small>Create local-config.json with {"maps": "your-api-key"} for local development</small></p>
                    </div>
                `;
            };
            
            document.head.appendChild(script);
        }
        
        // Load when DOM is ready
        document.addEventListener('DOMContentLoaded', loadGoogleMapsAPI);
    </script>
</body>
</html>
